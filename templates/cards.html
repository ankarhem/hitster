{% extends "base.html" %}

{% import "macros.html" as macros %}

{% block title %}Hitster Cards - {{ title }}{% endblock %}

{% block head %}
<style>
    @page {
        size: A4;
        margin: 0;
    }
    
    @media print {
        .print\:card-grid {
            display: grid;
            grid-template-columns: repeat(3, 70mm);
            grid-template-rows: repeat(4, 70mm);
            gap: 0;
            width: 210mm;
            height: 297mm;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }
        
        .print\:qr-code {
            width: 60mm;
            height: 60mm;
        }
        
        .print\:text-sm { font-size: 12px; }
        .print\:text-xs { font-size: 10px; }
        .print\:text-xl { font-size: 24px; }
        .print\:break-after-page { break-after: page; }
        .print\:block { display: block; }
    }
    
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>
{% endblock %}

{% block body %}
{# View mode info (hidden in print) #}
<div class="print:hidden bg-blue-50 border-b border-blue-200 p-4 text-center">
    <h2 class="text-lg font-semibold text-blue-800 mb-1">Hitster Cards - {{ title }}</h2>
    <p class="text-sm text-blue-600">
        {{ total_cards }} {% if total_cards == 1 %}song{% else %}songs{% endif %}
        • Print or save as PDF for dual-sided 70×70mm cards
    </p>
    <p class="text-xs text-blue-500 mt-1">A4 paper • 3×4 grid • Front pages first, then back sides</p>
</div>

{# Front Pages (QR codes only) #}
{%- if !pages.is_empty() -%}
<div class="print:hidden mb-8 text-center">
    <h3 class="text-lg font-semibold text-gray-700 mb-2">Front Pages (QR Codes)</h3>
    <p class="text-sm text-gray-500">These will be printed first - one side only</p>
</div>

{%- for page in pages -%}
<div class="grid grid-cols-3 grid-rows-4 gap-4 justify-center p-6 bg-gray-50 mb-8 print:card-grid" 
     style="width: 210mm; height: 280mm;">
      {%- for card in page -%}
    <div class="flex items-center justify-center w-16 h-16 print:qr-code border-2 border-gray-300 rounded">
        {%- if card.qr_data_url.is_empty() -%}
        <div class="text-center text-gray-400">
            <div class="text-2xl mb-1">♪</div>
            <div class="text-xs">QR unavailable</div>
        </div>
        {%- else -%}
        <img src="{{ card.qr_data_url }}" alt="QR Code" class="w-full h-full">
        {%- endif -%}
    </div>
    {%- endfor -%}
</div>
{%- endfor -%}
{%- endif -%}

{# Back Pages (Song details - hidden in view mode) #}
<div class="hidden print:block">
    {%- for page in pages -%}
    <div class="print:card-grid print:break-after-page">
        {%- for card in page -%}
        <div class="flex flex-col p-3 w-full h-full border border-gray-300 rounded">
            <h3 class="font-bold leading-tight mb-2 print:text-sm line-clamp-2" title="{{ card.title }}">
                {{ card.title }}
            </h3>
            <p class="text-gray-600 leading-tight mb-4 print:text-xs line-clamp-3" title="{{ card.artist }}">
                {{ card.artist }}
            </p>
            
            <div class="mt-auto text-center">
                <span class="font-bold print:text-xl">
                    {{ card.year }}
                </span>
            </div>
        </div>
        {%- endfor -%}
    </div>
    {%- endfor -%}
</div>
{% endblock %}